<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>10-Minuten-Herausforderung</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <!-- DaisyUI -->
  <link href="https://cdn.jsdelivr.net/npm/daisyui@1.20.0/dist/full.css" rel="stylesheet">
  <!-- html2pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <!-- RecordRTC.js -->
  <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
</head>
<body class="bg-base-200 text-base-content">
  <!-- Header mit DaisyUI Navbar -->
  <header class="navbar bg-base-300">
    <div class="flex-1">
      <a class="btn btn-ghost normal-case text-xl">10-Minuten-Herausforderung</a>
    </div>
    <div class="flex-none">
      <!-- Farbschema Dropdown -->
      <div class="dropdown dropdown-end">
        <label tabindex="0" class="btn btn-secondary m-1">Theme</label>
        <ul tabindex="0" class="dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52">
          <li><a href="#" onclick="setTheme('light')">Licht</a></li>
          <li><a href="#" onclick="setTheme('dark')">Dunkel</a></li>
          <li><a href="#" onclick="setTheme('cupcake')">Cupcake</a></li>
          <li><a href="#" onclick="setTheme('emerald')">Emerald</a></li>
          <li><a href="#" onclick="setTheme('synthwave')">Synthwave</a></li>
          <li><a href="#" onclick="setTheme('dracula')">Dracula</a></li>
        </ul>
      </div>
    </div>
  </header>

  <div class="container mx-auto p-4 max-w-screen-md">
    <div class="flex flex-col items-center">
      <button class="btn btn-secondary mt-2 w-full" onclick="confirmResetTasks()">Neues Set an Aufgaben</button>
      <button class="btn btn-accent mt-4 w-full" onclick="printTasksAsPDF()">Alle Aufgaben als PDF drucken</button>
    </div>

    <!-- Aufgaben-Bereich -->
    <div id="tasks" class="mt-4">
      <!-- Aufgabe 1: Lesen -->
      <div id="task1" class="task card shadow-lg bg-base-100 mb-8">
        <div class="card-body">
          <h2 class="card-title text-lg font-bold">Aufgabe 1: Lesen</h2>
          <div class="flex items-center justify-center">
            <progress id="progress1" class="progress progress-primary w-full max-w-xs" value="100" max="100"></progress>
            <span id="timer1" class="ml-4 text-lg font-mono">10:00</span>
          </div>
          <p class="py-4 text-center">Lesen Sie den folgenden Text laut vor, w√§hrend die Aufnahme l√§uft:</p>
          <p id="readText" class="py-2 text-center">
            <strong>Lesetext:</strong><br>
            <!-- Platzhalter, wird durch JavaScript ersetzt -->
          </p>
          <button id="toggleTimer1" class="btn btn-primary mt-4 w-full" onclick="toggleTask(1)">Aufgabe beginnen</button>
          <div id="savedRecording" class="mt-4 hidden">
            <audio id="audioPlayer" controls></audio>
            <span id="recordingName" class="ml-2"></span>
            <button class="btn btn-error btn-sm ml-4" onclick="confirmDeleteRecording()">üóëÔ∏è L√∂schen</button>
          </div>
        </div>
      </div>

      <!-- Aufgabe 2: Schreiben -->
      <div id="task2" class="task card shadow-lg bg-base-100 mb-8">
        <div class="card-body">
          <h2 class="card-title text-lg font-bold">Aufgabe 2: Abschreiben</h2>
          <div class="flex items-center justify-center">
            <progress id="progress2" class="progress progress-secondary w-full max-w-xs" value="100" max="100"></progress>
            <span id="timer2" class="ml-4 text-lg font-mono">10:00</span>
          </div>
          <p id="writeText" class="mt-4 text-center">
            <!-- Platzhalter, wird durch JavaScript ersetzt -->
          </p>
          <button id="toggleTimer2" class="btn btn-primary mt-4 w-full" onclick="toggleTask(2)">Aufgabe beginnen</button>
          <!-- Stilisiertes Datei-Upload-Feld -->
          <label for="proofUpload" class="btn btn-primary mt-4 w-full">Foto der Abschrift hochladen</label>
          <input id="proofUpload" type="file" accept="image/*" class="hidden" onchange="uploadProof()" />
          <div id="savedProof" class="mt-4 hidden">
            <span id="proofName" class="ml-2"></span>
            <button class="btn btn-error btn-sm ml-4" onclick="confirmDeleteProof()">üóëÔ∏è L√∂schen</button>
            <a id="proofPreview" href="#" class="btn btn-link ml-2 hidden" target="_blank">Vorschau anzeigen</a>
          </div>
        </div>
      </div>

      <!-- Aufgabe 3: Mathe -->
      <div id="task3" class="task card shadow-lg bg-base-100 mb-8">
        <div class="card-body">
          <h2 class="card-title text-lg font-bold">Aufgabe 3: Rechenaufgaben</h2>
          <div class="flex items-center justify-center">
            <progress id="progress3" class="progress progress-accent w-full max-w-xs" value="100" max="100"></progress>
            <span id="timer3" class="ml-4 text-lg font-mono">10:00</span>
          </div>
          <button id="toggleTimer3" class="btn btn-primary mt-4 w-full" onclick="toggleTask(3)">Aufgabe beginnen</button>
          <div id="mathText" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"></div>
        </div>
      </div>
    </div>

    <!-- Abgabe-Button -->
    <button id="submitBtn" class="btn btn-success fixed bottom-4 right-4 hidden" onclick="checkSubmission()">Abgeben</button>
  </div>

  <!-- Modale f√ºr Validierungen -->
  <!-- (Die Modale bleiben unver√§ndert) -->
  <!-- Modale f√ºr Validierungen -->
  <input type="checkbox" id="validationModal" class="modal-toggle" />
  <div class="modal">
    <div class="modal-box">
      <h3 class="font-bold text-lg">Abgabe-Validierung</h3>
      <p id="validationMessage" class="py-4"></p>
      <div class="modal-action">
        <label for="validationModal" class="btn">Schlie√üen</label>
      </div>
    </div>
  </div>

  <!-- Best√§tigungsmodal f√ºr das Stoppen der Aufnahme -->
  <input type="checkbox" id="confirmStopRecordingModal" class="modal-toggle" />
  <div class="modal">
    <div class="modal-box">
      <h3 class="font-bold text-lg">Aufnahme beenden?</h3>
      <p class="py-4">M√∂chten Sie die Aufnahme wirklich beenden? Falls dies ein Versehen war, k√∂nnen Sie den Vorgang fortsetzen.</p>
      <div class="modal-action">
        <label class="btn btn-error" onclick="stopTaskConfirmed(1)">Ja, beenden</label>
        <label for="confirmStopRecordingModal" class="btn">Abbrechen</label>
      </div>
    </div>
  </div>

  <!-- Best√§tigungsmodal f√ºr das L√∂schen der Aufnahme -->
  <input type="checkbox" id="confirmDeleteRecordingModal" class="modal-toggle" />
  <div class="modal">
    <div class="modal-box">
      <h3 class="font-bold text-lg">Aufnahme l√∂schen?</h3>
      <p class="py-4">M√∂chten Sie die Aufnahme wirklich l√∂schen?</p>
      <div class="modal-action">
        <label class="btn btn-error" onclick="deleteRecording()">Ja, l√∂schen</label>
        <label for="confirmDeleteRecordingModal" class="btn">Abbrechen</label>
      </div>
    </div>
  </div>

  <!-- Best√§tigungsmodal f√ºr das L√∂schen des Beweises -->
  <input type="checkbox" id="confirmDeleteProofModal" class="modal-toggle" />
  <div class="modal">
    <div class="modal-box">
      <h3 class="font-bold text-lg">Beweis l√∂schen?</h3>
      <p class="py-4">M√∂chten Sie den Beweis wirklich l√∂schen?</p>
      <div class="modal-action">
        <label class="btn btn-error" onclick="deleteProof()">Ja, l√∂schen</label>
        <label for="confirmDeleteProofModal" class="btn">Abbrechen</label>
      </div>
    </div>
  </div>

  <!-- Best√§tigungsmodal f√ºr das Zur√ºcksetzen -->
  <input type="checkbox" id="confirmResetModal" class="modal-toggle" />
  <div class="modal">
    <div class="modal-box">
      <h3 class="font-bold text-lg">Aufgaben zur√ºcksetzen?</h3>
      <p class="py-4">M√∂chten Sie wirklich die Aufgaben zur√ºcksetzen? Alle bisherigen Fortschritte gehen verloren.</p>
      <div class="modal-action">
        <label class="btn btn-error" onclick="resetTasks()">Ja, zur√ºcksetzen</label>
        <label for="confirmResetModal" class="btn">Abbrechen</label>
      </div>
    </div>
  </div>

  <!-- Druckfreundlicher Bereich -->
  <div id="printableTasks" class="hidden">
    <div style="padding: 2rem; background-color: white; color: black;">
      <div id="printableTask1" style="margin-bottom: 2rem;">
        <h1 style="font-size: 2rem; font-weight: bold; margin-bottom: 1rem; text-align: center;">10-Minuten-Herausforderung</h1>
        <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">Aufgabe 1: Lesen</h2>
        <p><strong>Lesetext:</strong></p>
        <p id="printableReadText" style="border-bottom: 2px dashed black; padding-bottom: 1rem; margin-bottom: 1rem; min-height: 60px;">
          <!-- Lesetext -->
        </p>
        <p style="margin-bottom: 2rem;"><strong>Notizen:</strong></p>
        <div style="border-top: 2px dashed black; padding-top: 1rem; margin-bottom: 2rem; min-height: 100px;">
          <!-- Notizenbereich -->
        </div>
      </div>
      <div id="printableTask2" style="margin-bottom: 2rem;">
        <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">Aufgabe 2: Abschreiben</h2>
        <p><strong>Abschreibtext:</strong></p>
        <p id="printableWriteText" style="border-bottom: 2px dashed black; padding-bottom: 1rem; margin-bottom: 1rem; min-height: 60px;">
          <!-- Abschreibtext -->
        </p>
        <p style="margin-bottom: 2rem;"><strong>Foto der Abschrift:</strong></p>
        <div id="printableProof" style="border: 2px dashed black; padding: 1rem; margin-bottom: 2rem; min-height: 150px; text-align: center;">
          <!-- Platz f√ºr das Foto oder QR-Code -->
          <!-- Wird dynamisch eingef√ºgt -->
        </div>
      </div>
      <div id="printableTask3">
        <h2 style="font-size: 1.5rem; font-weight: bold; margin-bottom: 0.5rem;">Aufgabe 3: Rechenaufgaben</h2>
        <div id="printableMathTasks">
          <!-- Rechenaufgaben -->
          <!-- Jede Aufgabe mit einer Linie f√ºr die Antwort -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // JavaScript-Code wie zuvor, mit angepasster printTasksAsPDF-Funktion

    // ... (Restlicher JavaScript-Code bleibt unver√§ndert)

    function printTasksAsPDF() {
      // F√ºllen des druckfreundlichen Bereichs mit aktuellen Daten
      const printableDiv = document.getElementById("printableTasks");
      printableDiv.classList.remove('hidden'); // Element einblenden

      // Aufgabe 1: Lesen
      const readText = document.getElementById("readText").innerText.replace("Lesetext:\n", "");
      const printableTask1 = document.getElementById("printableReadText");
      printableTask1.innerText = readText;

      // Aufgabe 2: Schreiben
      const writeText = document.getElementById("writeText").innerText;
      const printableTask2 = document.getElementById("printableWriteText");
      printableTask2.innerText = writeText;

      // Foto der Abschrift
      const printableProof = document.getElementById("printableProof");
      printableProof.innerHTML = ''; // Leeren vor dem Bef√ºllen
      if (savedProofURL) {
          // Wenn ein Foto hochgeladen wurde, f√ºge es ein
          const img = document.createElement("img");
          img.src = savedProofURL;
          img.style.maxWidth = "100%";
          img.style.height = "auto";
          printableProof.appendChild(img);
      } else {
          // Wenn kein Foto hochgeladen wurde, f√ºge den QR-Code ein
          const qrImg = document.createElement("img");
          qrImg.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAACgAQMAAACSLZK3AAAABlBMVEUAAAD///+l2Z/dAAAAAWJLR0QAiAUdSAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABh0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4xMfEgaZUAAAAHdElNRQfkCxEXBQ7hHrQcAAAAK0lEQVRIx+3NsQ0AIBAEwaT1T8KF9AoVNBx3/SEQCAAAECBAgQIsERHiF3SSof3+nxn4JKkJAwoYTYgAAAABJRU5ErkJggg==';
          qrImg.style.maxWidth = "100%";
          qrImg.style.height = "auto";
          printableProof.appendChild(qrImg);
      }

      // Aufgabe 3: Mathe
      const storedTasks = JSON.parse(localStorage.getItem("tasks"));
      const mathTasks = storedTasks.task3.mathTasks;
      const mathPrintable = document.getElementById("printableMathTasks");
      mathPrintable.innerHTML = ''; // Leeren vor dem Bef√ºllen

      mathTasks.forEach((task, index) => {
        const taskDiv = document.createElement("div");
        taskDiv.style.marginBottom = "1rem";
        taskDiv.style.fontSize = "1rem";

        const taskNumber = document.createElement("span");
        taskNumber.style.marginRight = "0.5rem";
        taskNumber.innerText = `${index + 1}.`;

        const taskTextElement = document.createElement("span");
        taskTextElement.style.marginRight = "0.5rem";
        taskTextElement.innerText = `${task.num1} ${task.operator} ${task.num2} =`;

        const answerLine = document.createElement("span");
        answerLine.style.borderBottom = "1px solid black";
        answerLine.style.display = "inline-block";
        answerLine.style.width = "50px";
        answerLine.style.marginLeft = "0.5rem";

        taskDiv.appendChild(taskNumber);
        taskDiv.appendChild(taskTextElement);
        taskDiv.appendChild(answerLine);

        mathPrintable.appendChild(taskDiv);
      });

      // Optionen f√ºr html2pdf.js
      const opt = {
        margin: [0.5, 0.5, 0.5, 0.5], // Oben, links, unten, rechts
        filename: 'Aufgabenblatt.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
      };

      // PDF generieren
      html2pdf().set(opt).from(printableDiv).save().then(() => {
        printableDiv.classList.add('hidden'); // Element wieder ausblenden
      }).catch(error => {
        console.error("Fehler bei der PDF-Erstellung:", error);
        showValidationModal("Fehler bei der PDF-Erstellung.");
        printableDiv.classList.add('hidden'); // Element wieder ausblenden, auch bei Fehlern
      });
    }

    // ... (Restlicher JavaScript-Code)
  </script>
</body>
</html>
